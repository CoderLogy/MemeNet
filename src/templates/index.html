<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="MemeNet" description="MemeNet is bringing you the best memes around the world">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
    <script type="text/javascript" src="{{ url_for('static', filename='firebase.js') }}"></script>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <title>MemeNet</title>
</head>

<body>
    <main>
        {% for image in images %}
        <div class="container">
            <img class="image" src="{{ image.url }}" alt="Image">
            <div class="actions">
                <button onclick="likeImage('{{ image.url }}')">Like</button>
                <button onclick="dislikeImage('{{ image.url }}')">Dislike</button>
                <button onclick="showDescription('{{ image.title }}', '{{ image.url }}', '{{ image.tags }}')">Description</button>
                <!-- Add more action buttons as needed -->
            </div>
        </div>
        <h1>{{image.tags}}</h1>
        {% endfor %}
    </main>
    <div id="descriptionModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle"></h2>
            <p id="modalTags"></p>
        </div>
    </div>
    <footer>
        <a href="{{ url_for('index') }}"><button>Home</button></a>
        <a href="{{ url_for('search') }}"><button>Search</button></a>
        <a href="{{ url_for('post') }}"><button>Post</button></a>
    </footer>
    <script>
        let currentPage = 1;
        function debounce(func, wait, immediate) {
                let timeout;
                return function () {
                    const context = this, args = arguments;
                    const later = function () {
                        timeout = null;
                        if (!immediate) func.apply(context, args);
                    };
                    const callNow = immediate && !timeout;
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                    if (callNow) func.apply(context, args);
                };
            }


            // Debounce the loadMoreImages function to control its invocation rate
            const debouncedLoadMoreImages = debounce(loadMoreImages, 300);

            // Load more images when the user scrolls
            window.addEventListener('scroll', function () {
                const windowHeight = window.innerHeight;
                const documentHeight = document.documentElement.scrollHeight;
                const scrollTop = window.scrollY;

                // Check if the user is near the bottom of the page
                if (windowHeight + scrollTop >= documentHeight - 100) {
                    debouncedLoadMoreImages();
                }
            });
          // JavaScript functions for handling modal display
           function showDescription(title, url, tags) {
                // Convert tags to an array if it's stored as a string in the metadata
                let tagsArray;

                try {
                    // Attempt to parse the tags as JSON
                    tagsArray = JSON.parse(tags);
                } catch (error) {
                    // If parsing fails, handle it (e.g., treat it as a single string tag)
                    tagsArray = [tags];
                }

                document.getElementById('modalTitle').innerText = title;
                document.getElementById('modalTags').innerText = 'Tags: ' + tagsArray.join(', ');
                document.getElementById('descriptionModal').style.display = 'block';
                console.log(
                   document.getElementById('modalTitle').innerText = title,
                   document.getElementById('modalTags').innerText = 'Tags: ' + tags.join(', '),
                   document.getElementById('modalImage').src = url,
                   document.getElementById('descriptionModal').style.display = 'block'
               );
            }
            function closeModal() {
                document.getElementById('descriptionModal').style.display = 'none';
            }


        function loadMoreImages() {
            // Fetch more images from the server using AJAX or any other method
            // Update the 'images' array with the new images
            // For demonstration, let's assume you add more images to the existing array
                        currentPage++;

            fetch("/")
        .then(response => response.json())
        .then(data => {
            // Append the new images to the main container
            const main = document.querySelector('main');
            data.images.forEach(image => {
                const container = document.createElement('div');
                container.className = 'container';
                container.innerHTML = `
                        <img class="image" src="${image.url}" alt="Image">
                        <div class="actions">
                            <button onclick="likeImage('${image.url}')">Like</button>
                            <button onclick="commentImage('${image.url}')">Dislike</button>
                            <button onclick="showDescription('${image.title}', '${image.url}', ${JSON.stringify(image.tags)})">Description</button>
                            <!-- Add more action buttons as needed -->
                        </div>
                    `;
                main.appendChild(container);
            });
        });
        }

        function likeImage(imageUrl) {
            // Handle like action
            alert(`Liked image: ${imageUrl}`);
        }

        function dislikeImage(imageUrl) {
            // Handle comment action
            alert(`Dislikex on image: ${imageUrl}`);
        }

        // Implement additional JavaScript functions as needed
    </script>
</body>
</html>